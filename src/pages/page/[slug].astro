---
import BlogPost from '@layouts/BlogPost.astro';
import PageContent from '@components/PageContent.astro';
import { PageService } from '@util/pageService';
import type { Page } from '@domain/page';
import { optimizeImages } from '@util/optimizeImages';

export async function getStaticPaths() {
  const { pages } = await PageService.getAllPages();
  return pages.map((page: Page) => ({
    params: { slug: page.slug },
    props: { page },
  }));
}

const { page } = Astro.props;
const { page: fullPage } = await PageService.getPageBySlug(page.slug);

if (fullPage?.body?.html) {
  fullPage.body.html = await optimizeImages(fullPage.body.html);
}
---

<BlogPost {...fullPage}>
  <PageContent page={fullPage} />
</BlogPost>
